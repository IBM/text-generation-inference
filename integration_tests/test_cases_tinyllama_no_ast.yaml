# Test empty requests
- name: Empty 1
  request: {}
  response: {}
- name: Empty 2
  request:
    params: {}
    requests: []
  response: {}

# Basic Greedy (implicit)
- name: Basic Greedy, max new tokens (implicit)
  request:
    requests:
    - {"text": "Once upon a time,"}
  response:
    responses:
      - generatedTokenCount: 20
        inputTokenCount: 5
        stopReason: MAX_TOKENS
        text: ' a little girl named Lily went to the park with her mom.
    
        When they got to the park'


# Basic Greedy with explict BOS
- name: Basic Greedy with explict BOS
  request:
    requests:
      - {"text": "<s>Once upon a time,"}
  response:
    responses:
      - generatedTokenCount: 20
        inputTokenCount: 6
        stopReason: MAX_TOKENS
        text: ' there was a little girl named Lily. She had a big, red ball that she loved
          to play'


# Basic Greedy (explicit)
- name: Basic Greedy, max new tokens (explicit)
  request:
    params:
      method: GREEDY
      stopping: {"maxNewTokens": 17}
    requests:
      - {"text": "Once upon a time,"}
  response:
    responses:
      - generatedTokenCount: 17
        inputTokenCount: 5
        stopReason: MAX_TOKENS
        text: ' a little girl named Lily went to the park with her mom.

        When they got'


# Input tokens with explicit BOS
- name: Return input tokens with explicit BOS
  request:
    params:
      method: GREEDY
      stopping: {"maxNewTokens": 8}
      response:
        inputTokens: true
    requests:
      - {"text": "<s>Once upon a time,"}
  response:
    responses:
      - generatedTokenCount: 8
        inputTokenCount: 6
        inputTokens:
          - text: <s>
            # This token currently differs from tokenizer-added BOS case
          - text: Once
          - text: "\u2581upon"
          - text: "\u2581a"
          - text: "\u2581time"
          - text: ','
        stopReason: MAX_TOKENS
        text: ' there was a little girl named Lily.'



# Tokenize with tokens
- name: Tokenize with tokens
  request_type: tokenize
  request:
    return_tokens: true
    requests:
      - {"text": "The very long story is written by a very long story"}
  response:
    responses:
      - tokenCount: 11
        tokens:
          - "\u2581The"
          - "\u2581very"
          - "\u2581long"
          - "\u2581story"
          - "\u2581is"
          - "\u2581written"
          - "\u2581by"
          - "\u2581a"
          - "\u2581very"
          - "\u2581long"
          - "\u2581story"


- name: Long input with tokens truncated
  request:
    params:
      truncateInputTokens: 25
      stopping:
        maxNewTokens: 14
      response:
        inputText: true
    requests:
    - text: >
        The hallway smelt of boiled cabbage and old rag mats. At one end of it a coloured poster, too large for
        indoor display, had been tacked to the wall. It depicted simply an enormous face, more than a metre wide:
        the face of a man of about forty-five, with a heavy black moustache and ruggedly handsome features.
        Winston made for the stairs. It was no use trying the lift. Even at the best of times it was seldom working,
        and at present the electric current was cut off during daylight hours. It was part of the economy drive in
        preparation for Hate Week. The flat was seven flights up, and Winston, who was thirty-nine and had a
        varicose ulcer above his right ankle, went slowly, resting several times on the way. On each landing,
        opposite the lift-shaft, the poster with the enormous face gazed from the wall.
        The hallway smelt of boiled cabbage and old rag mats. At one end of it a coloured poster, too large for
        indoor display, had been tacked to the wall. It depicted simply an enormous face, more than a metre wide:
        the face of a man of about forty-five, with a heavy black moustache and ruggedly handsome features.
        Winston made for the stairs. It was no use trying the lift. Even at the best of times it was seldom working,
        and at present the electric current was cut off during daylight hours. It was part of the economy drive in
        preparation for Hate Week. The flat was seven flights up, and Winston, who was thirty-nine and had a
        varicose ulcer above his right ankle, went slowly, resting several times on the way. On each landing,
        opposite the lift-shaft, the poster with the enormous face gazed from the wall.
  response:
    responses:
      - generatedTokenCount: 14
        inputTokenCount: 25
        stopReason: MAX_TOKENS
        text: 'The hallway smelt of boiled cabbage and old rag mats. At one end of it a
        coloured poster, too large for indoor display, had been tacked to the wall. It
        depicted simply an enormous face, more than a metre wide: the face of a man of
        about forty-five, with a heavy black moustache and ruggedly handsome features.
        Winston made for the stairs. It was no use trying the lift. Even at the best of
        times it was seldom working, and at present the electric current was cut off during
        daylight hours. It was part of the economy drive in preparation for Hate Week.
        The flat was seven flights up, and Winston, who was thirty-nine and had a varicose
        ulcer above his right ankle, went slowly, resting several times on the way. On
        each landing, opposite the lift-shaft, the poster with the enormous face gazed
        from the wall. The hallway smelt of boiled cabbage and old rag mats. At one end
        of it a coloured poster, too large for indoor display, had been tacked to the
        wall. It depicted simply an enormous face, more than a metre wide: the face of
        a man of about forty-five, with a heavy black moustache and ruggedly handsome
        features. Winston made for the stairs. It was no use trying the lift. Even at
        the best of times it was seldom working, and at present the electric current was
        cut off during daylight hours. It was part of the economy drive in preparation
        for Hate Week. The flat was seven flights up, and Winston, who was thirty-nine
        and had a varicose ulcer above his right ankle, went slowly, resting several times
        on the way. On each landing, opposite the lift-shaft, the poster with the enormous
        face gazed from the wall.
    
        The people in the town were so surprised that they had never seen before'


- name: Sampling with multiple requests
  request:
    params:
      method: SAMPLE
      sampling:
        seed: 99
        top_k: 3
        top_p: 0.7
        typical_p: 0.6
        temperature: 0.99
      stopping: {"maxNewTokens": 2}
      response:
        generatedTokens: true
        tokenLogprobs: true
        topNTokens: 2
    requests:
    - {"text": "<s>"}
    - {"text": "A boy"}
    - {"text": "A girl"}
  response:
    responses:
      - generatedTokenCount: 2
        inputTokenCount: 1
        seed: '99'
        stopReason: MAX_TOKENS
        text: ' Once upon'
        tokens:
          - text: "\u2581Once"
            topTokens:
              - text: "\u2581Once"
          - text: "\u2581upon"
            topTokens:
              - text: "\u2581upon"
      - generatedTokenCount: 2
        inputTokenCount: 2
        seed: '99'
        stopReason: MAX_TOKENS
        text: ' and a'
        tokens:
          - text: "\u2581and"
            topTokens:
              - text: "\u2581and"
          - text: "\u2581a"
            topTokens:
              - text: "\u2581a"
      - generatedTokenCount: 2
        inputTokenCount: 2
        seed: '99'
        stopReason: MAX_TOKENS
        text: ' and a'
        tokens:
          - text: "\u2581and"
            topTokens:
              - text: "\u2581and"
          - text: "\u2581a"
            topTokens:
              - text: "\u2581a"


## Prompt prefix
- name: Greedy with tuned prompt prefix
  request:
    prefixId: tinyllama
    params:
      method: GREEDY
      stopping:
        maxNewTokens: 13
    requests:
    - {"text": ""}
  response:
    responses:
      - generatedTokenCount: 13
        stopReason: MAX_TOKENS
        text: " \nThe little girl was so sad. She wanted to go"


# Prompt loaded from peft adapter
- name: Greedy with tuned peft adapter prefix
  request:
    prefixId: tinyllama_peft_adapter
    params:
      method: GREEDY
      stopping:
        maxNewTokens: 13
    requests:
    - {"text": ""}
  response:
    responses:
      - generatedTokenCount: 13
        stopReason: MAX_TOKENS
        text: ie was going to the park. She was so excited to play


# Prompt loaded from peft adapter saved in a raw .bin file
- name: Greedy with tuned peft adapter prefix in raw .bin format
  request:
    prefixId: tinyllama_peft_adapter_raw
    params:
      method: GREEDY
      stopping:
        maxNewTokens: 13
    requests:
    - {"text": ""}
  response:
    responses:
      - generatedTokenCount: 13
        stopReason: MAX_TOKENS
        text: ie was going to the park. She was so excited to play


  # Prompt prefix with truncation
- name: Greedy with tuned prompt prefix with truncation
  request:
    prefixId: tinyllama
    params:
      method: GREEDY
      # this truncate will only leave the BOS token
      truncateInputTokens: 1
      stopping:
        maxNewTokens: 13
    requests:
    - {"text": "this will all be truncated"}
  response:
    responses:
      - generatedTokenCount: 13
        inputTokenCount: 1
        stopReason: MAX_TOKENS
        text: ' around the forest, and all the other animals were so excited.'


# Prompt prefix returning input and generated tokens
- name: Greedy with tuned prompt prefix and returned tokens
  request:
    prefixId: tinyllama
    params:
      method: GREEDY
      stopping: {"maxNewTokens": 2}
      response:
        inputTokens: true
        generatedTokens: true
        tokenLogprobs: true
        tokenRanks: true
        topNTokens: 2
    requests:
    - {"text": "Luke"}
  response:
    responses:
      - generatedTokenCount: 2
        inputTokenCount: 1
        inputTokens:
          - logprob: NaN
            text: <unk>
          - logprob: -15.04933
            rank: 22217
            text: <unk>
            topTokens:
              - logprob: -1.1141624
                text: ''''
              - logprob: -4.0228844
                text: "\u2581the"
          - logprob: -13.876277
            rank: 21532
            text: <unk>
            topTokens:
              - logprob: -3.9175775
                text: "\u2581beautiful"
              - logprob: -4.162982
                text: "\u2581big"
          - logprob: -14.27906
            rank: 20730
            text: <unk>
            topTokens:
              - logprob: -1.258202
                text: '!'
              - logprob: -3.2666845
                text: ','
          - logprob: -14.407387
            rank: 21752
            text: <unk>
            topTokens:
              - logprob: -0.7473863
                text: "\u2581away"
              - logprob: -3.7207005
                text: "\u2581home"
          - logprob: -14.740825
            rank: 21652
            text: <unk>
            topTokens:
              - logprob: -2.3787282
                text: "\u2581away"
              - logprob: -2.5638993
                text: "\u2581and"
          - logprob: -15.371114
            rank: 20720
            text: <unk>
            topTokens:
              - logprob: -1.379596
                text: .
              - logprob: -2.1441567
                text: "\u2581in"
          - logprob: -9.495043
            rank: 636
            text: "\u2581Luke"
            topTokens:
              - logprob: -0.8159746
                text: "\u2581"
              - logprob: -1.58684
                text: <0x0A>
        stopReason: MAX_TOKENS
        text: ' was so'
        tokens:
          - logprob: -1.5606049
            rank: 1
            text: "\u2581was"
            topTokens:
              - logprob: -1.5606049
                text: "\u2581was"
              - logprob: -1.6203421
                text: "\u2581had"
          - logprob: -1.2640134
            rank: 1
            text: "\u2581so"
            topTokens:
              - logprob: -1.2640134
                text: "\u2581so"
              - logprob: -1.9529773
                text: "\u2581very"
